<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<room>
  <caption></caption>
  <width>1920</width>
  <height>1920</height>
  <vsnap>64</vsnap>
  <hsnap>64</hsnap>
  <isometric>0</isometric>
  <speed>60</speed>
  <persistent>0</persistent>
  <colour>12632256</colour>
  <showcolour>-1</showcolour>
  <code>//Randomize 
randomize();
//Create grid if it doesn't exist
if (!instance_exists(obj_grid))
instance_create(0,0,obj_grid);
//Generate Boundary Walls around room
var wall_height = sprite_get_height(object_get_sprite(obj_wall));
var wall_width = sprite_get_width(object_get_sprite(obj_wall));
var wall1 = instance_create(0,0,obj_wall);
wall1.image_xscale = obj_grid.hcells;
var wall2 = instance_create(0,room_height-wall_height,obj_wall  );
wall2.image_xscale = obj_grid.hcells;
var wall3 = instance_create(0,wall_height,obj_wall);
wall3.image_yscale = obj_grid.vcells-1;
var wall4 = instance_create(room_width-wall_width,wall_height,obj_wall);
wall4.image_yscale = obj_grid.vcells-1;
//Add walls to grid if they exist
if (instance_exists(obj_wall))
mp_grid_add_instances(grid,obj_wall,0);
//Generate Random Trees
//Get number of trees on level and free spaces
var trees = irandom_range(obj_game_control.level[obj_game_control.current_level,7],obj_game_control.level[obj_game_control.current_level,8]);
//Update number of actual trees in the game control
obj_game_control.level[obj_game_control.current_level, 9] = trees;

//Spawn them and add them to the grid one by one
var i = 0;
while (i&lt;trees)
{
var tree_cell_x = irandom_range(0,obj_grid.hcells);
var tree_cell_y = irandom_range(0,obj_grid.vcells);
if (mp_grid_get_cell(grid,tree_cell_x,tree_cell_y)==0)
{
instance_create(tree_cell_x*obj_grid.cell_width,tree_cell_y*obj_grid.cell_height,obj_tree)
mp_grid_add_cell(grid,tree_cell_x,tree_cell_y);
i++;
}
}
//Spawn(Move) Player at Random Cell + modify view
var player_spawned = false;
while (!player_spawned)
{
var player_cell_x = irandom_range(0,obj_grid.hcells);
var player_cell_y = irandom_range(0,obj_grid.vcells);
if (mp_grid_get_cell(grid,player_cell_x,player_cell_y)==0)
{
obj_player.x = player_cell_x*obj_grid.cell_width+((sprite_get_bbox_right(object_get_sprite(obj_player)))/2);
obj_player.y = player_cell_y*obj_grid.cell_height+((sprite_get_bbox_bottom(object_get_sprite(obj_player)))/2);
player_spawned = true;
view_yview[0] = obj_player.y-view_hview[0]/2;
view_xview[0] = obj_player.x-view_wview[0]/2;
}
}
//Spawn crystals
//Generate nr of random crystals
var crystals = irandom_range(obj_game_control.level[obj_game_control.current_level,16],obj_game_control.level[obj_game_control.current_level,17]);
for (var i = 0; i&lt;crystals;i++)
{
var crystal_spawned = false;
while (!crystal_spawned)
{
var crystal_cell_x = irandom_range(0,obj_grid.hcells);
var crystal_cell_y = irandom_range(0,obj_grid.vcells);
if (mp_grid_get_cell(grid,crystal_cell_x,crystal_cell_y)==0)
{
//Hard coded due to not knowing size of crystal sprite before spawning
instance_create(crystal_cell_x*obj_grid.cell_width+16,crystal_cell_y*obj_grid.cell_height+16,obj_crystal);
crystal_spawned = true;
}
}
}
//Tiles on the ground
for(var i = 0;i &lt; room_width/128; i++)
{
for (var j = 0; j&lt; room_height/128; j++)
{
tile_add(ts_grass_01,128,0,128,128,i*128,j*128,1)
}
}

//Spawn room control - controls waves and stuff like that
instance_create(0,0,obj_room_control);

//Generate data for the next room if it exists
if (obj_game_control.current_level+1&lt;array_height_2d(obj_game_control.level)-1)
{
//var rm_w = irandom_range(obj_game_control.level[obj_game_control.current_level+1,1],obj_game_control.level[obj_game_control.current_level+1,2])
//var rm_h = irandom_range(obj_game_control.level[obj_game_control.current_level+1,3],obj_game_control.level[obj_game_control.current_level+1,4])
room_set_width(2,obj_game_control.level[obj_game_control.current_level+1,1]*obj_game_control.grid_w);
room_set_height(2,obj_game_control.level[obj_game_control.current_level+1,2]*obj_game_control.grid_h);
obj_game_control.level[obj_game_control.current_level+1,5] = obj_game_control.level[obj_game_control.current_level+1,1]*obj_game_control.grid_w;
obj_game_control.level[obj_game_control.current_level+1,6] = obj_game_control.level[obj_game_control.current_level+1,1]*obj_game_control.grid_h;
//obj_game_control.level[obj_game_control.current_level+1,5] = rm_w*obj_game_control.grid_w;
//obj_game_control.level[obj_game_control.current_level+1,6] = rm_h*obj_game_control.grid_h;
}</code>
  <enableViews>-1</enableViews>
  <clearViewBackground>-1</clearViewBackground>
  <clearDisplayBuffer>-1</clearDisplayBuffer>
  <makerSettings>
    <isSet>0</isSet>
    <w>0</w>
    <h>0</h>
    <showGrid>0</showGrid>
    <showObjects>0</showObjects>
    <showTiles>0</showTiles>
    <showBackgrounds>0</showBackgrounds>
    <showForegrounds>0</showForegrounds>
    <showViews>0</showViews>
    <deleteUnderlyingObj>0</deleteUnderlyingObj>
    <deleteUnderlyingTiles>0</deleteUnderlyingTiles>
    <page>0</page>
    <xoffset>0</xoffset>
    <yoffset>0</yoffset>
  </makerSettings>
  <backgrounds>
    <background visible="-1" foreground="0" name="" x="0" y="0" htiled="-1" vtiled="-1" hspeed="0" vspeed="0" stretch="0"/>
    <background visible="0" foreground="0" name="" x="0" y="0" htiled="-1" vtiled="-1" hspeed="0" vspeed="0" stretch="0"/>
    <background visible="0" foreground="0" name="" x="0" y="0" htiled="-1" vtiled="-1" hspeed="0" vspeed="0" stretch="0"/>
    <background visible="0" foreground="0" name="" x="0" y="0" htiled="-1" vtiled="-1" hspeed="0" vspeed="0" stretch="0"/>
    <background visible="0" foreground="0" name="" x="0" y="0" htiled="-1" vtiled="-1" hspeed="0" vspeed="0" stretch="0"/>
    <background visible="0" foreground="0" name="" x="0" y="0" htiled="-1" vtiled="-1" hspeed="0" vspeed="0" stretch="0"/>
    <background visible="0" foreground="0" name="" x="0" y="0" htiled="-1" vtiled="-1" hspeed="0" vspeed="0" stretch="0"/>
    <background visible="0" foreground="0" name="" x="0" y="0" htiled="-1" vtiled="-1" hspeed="0" vspeed="0" stretch="0"/>
  </backgrounds>
  <views>
    <view visible="-1" objName="&lt;undefined&gt;" xview="0" yview="0" wview="800" hview="700" xport="0" yport="0" wport="1680" hport="1020" hborder="350" vborder="350" hspeed="14" vspeed="14"/>
    <view visible="0" objName="&lt;undefined&gt;" xview="0" yview="0" wview="1024" hview="768" xport="0" yport="0" wport="1024" hport="768" hborder="32" vborder="32" hspeed="-1" vspeed="-1"/>
    <view visible="0" objName="&lt;undefined&gt;" xview="0" yview="0" wview="1024" hview="768" xport="0" yport="0" wport="1024" hport="768" hborder="32" vborder="32" hspeed="-1" vspeed="-1"/>
    <view visible="0" objName="&lt;undefined&gt;" xview="0" yview="0" wview="1024" hview="768" xport="0" yport="0" wport="1024" hport="768" hborder="32" vborder="32" hspeed="-1" vspeed="-1"/>
    <view visible="0" objName="&lt;undefined&gt;" xview="0" yview="0" wview="1024" hview="768" xport="0" yport="0" wport="1024" hport="768" hborder="32" vborder="32" hspeed="-1" vspeed="-1"/>
    <view visible="0" objName="&lt;undefined&gt;" xview="0" yview="0" wview="1024" hview="768" xport="0" yport="0" wport="1024" hport="768" hborder="32" vborder="32" hspeed="-1" vspeed="-1"/>
    <view visible="0" objName="&lt;undefined&gt;" xview="0" yview="0" wview="1024" hview="768" xport="0" yport="0" wport="1024" hport="768" hborder="32" vborder="32" hspeed="-1" vspeed="-1"/>
    <view visible="0" objName="&lt;undefined&gt;" xview="0" yview="0" wview="1024" hview="768" xport="0" yport="0" wport="1024" hport="768" hborder="32" vborder="32" hspeed="-1" vspeed="-1"/>
  </views>
  <instances>
    <instance objName="obj_player" x="960" y="640" name="inst_6A30EFDF" locked="0" code="" scaleX="1" scaleY="1" colour="4294967295" rotation="0"/>
    <instance objName="obj_lighting" x="512" y="640" name="inst_0A120E4D" locked="0" code="" scaleX="1" scaleY="1" colour="4294967295" rotation="0"/>
    <instance objName="obj_camera" x="1472" y="1216" name="inst_327E8DDE" locked="0" code="" scaleX="1" scaleY="1" colour="4294967295" rotation="0"/>
    <instance objName="obj_sound" x="192" y="384" name="inst_A9725F4C" locked="0" code="" scaleX="1" scaleY="1" colour="4294967295" rotation="0"/>
    <instance objName="obj_gui" x="256" y="384" name="inst_DDA80E09" locked="0" code="" scaleX="1" scaleY="1" colour="4294967295" rotation="0"/>
  </instances>
  <tiles/>
  <PhysicsWorld>0</PhysicsWorld>
  <PhysicsWorldTop>0</PhysicsWorldTop>
  <PhysicsWorldLeft>0</PhysicsWorldLeft>
  <PhysicsWorldRight>1024</PhysicsWorldRight>
  <PhysicsWorldBottom>768</PhysicsWorldBottom>
  <PhysicsWorldGravityX>0</PhysicsWorldGravityX>
  <PhysicsWorldGravityY>10</PhysicsWorldGravityY>
  <PhysicsWorldPixToMeters>0.100000001490116</PhysicsWorldPixToMeters>
</room>
